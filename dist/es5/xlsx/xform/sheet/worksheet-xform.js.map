{"version":3,"sources":["../../../../../lib/xlsx/xform/sheet/worksheet-xform.js"],"names":["_","require","colCache","XmlStream","RelType","Merges","BaseXform","ListXform","RowXform","ColXform","DimensionXform","HyperlinkXform","MergeCellXform","DataValidationsXform","SheetPropertiesXform","SheetFormatPropertiesXform","SheetViewXform","PageMarginsXform","PageSetupXform","PrintOptionsXform","AutoFilterXform","PictureXform","DrawingXform","TablePartXform","RowBreaksXform","HeaderFooterXform","WorkSheetXform","options","maxRows","maxCols","map","sheetPr","dimension","sheetViews","tag","count","childXform","sheetFormatPr","cols","sheetData","empty","maxItems","autoFilter","mergeCells","rowBreaks","hyperlinks","pageMargins","dataValidations","pageSetup","headerFooter","printOptions","picture","drawing","tableParts","model","merges","comments","formulae","siFormulae","prepare","rows","rels","nextRid","r","length","forEach","hyperlink","rId","push","Id","Type","Hyperlink","Target","target","TargetMode","comment","Comments","id","vmlDrawing","VmlDrawing","item","refAddress","decodeAddress","ref","commentRefs","commentName","drawingRelsHash","bookImage","media","medium","type","imageId","Image","name","extension","background","image","drawingsCount","anchors","drawings","rIdImage","range","tables","table","Table","columns","column","style","dxfId","styles","addDxfStyle","xmlStream","openXml","StdDocAttributes","openNode","WORKSHEET_ATTRIBUTES","sheetFormatPropertiesModel","properties","defaultRowHeight","dyDescent","outlineLevelCol","outlineLevelRow","undefined","sheetPropertiesModel","outlineProperties","tabColor","fitToPage","pageMarginsModel","margins","printOptionsModel","showRowColHeaders","showGridLines","horizontalCentered","verticalCentered","render","dimensions","views","rel","leafNode","closeNode","node","parser","parseOpen","each","xform","reset","text","parseText","parseClose","outlinePropertiesx","sheetProperties","Object","assign","relationships","reduce","h","commentsMap","hyperlinkMap","address","filter","Boolean","row","cells","reconcile","drawingRel","match","drawingName","anchor","index","backgroundRel","split","mediaIndex","tablePart","xmlns","module","exports"],"mappings":";;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,CAAC,GAAGC,OAAO,CAAC,2BAAD,CAAjB;;AAEA,IAAMC,QAAQ,GAAGD,OAAO,CAAC,0BAAD,CAAxB;;AACA,IAAME,SAAS,GAAGF,OAAO,CAAC,2BAAD,CAAzB;;AAEA,IAAMG,OAAO,GAAGH,OAAO,CAAC,gBAAD,CAAvB;;AAEA,IAAMI,MAAM,GAAGJ,OAAO,CAAC,UAAD,CAAtB;;AAEA,IAAMK,SAAS,GAAGL,OAAO,CAAC,eAAD,CAAzB;;AACA,IAAMM,SAAS,GAAGN,OAAO,CAAC,eAAD,CAAzB;;AACA,IAAMO,QAAQ,GAAGP,OAAO,CAAC,aAAD,CAAxB;;AACA,IAAMQ,QAAQ,GAAGR,OAAO,CAAC,aAAD,CAAxB;;AACA,IAAMS,cAAc,GAAGT,OAAO,CAAC,mBAAD,CAA9B;;AACA,IAAMU,cAAc,GAAGV,OAAO,CAAC,mBAAD,CAA9B;;AACA,IAAMW,cAAc,GAAGX,OAAO,CAAC,oBAAD,CAA9B;;AACA,IAAMY,oBAAoB,GAAGZ,OAAO,CAAC,0BAAD,CAApC;;AACA,IAAMa,oBAAoB,GAAGb,OAAO,CAAC,0BAAD,CAApC;;AACA,IAAMc,0BAA0B,GAAGd,OAAO,CAAC,iCAAD,CAA1C;;AACA,IAAMe,cAAc,GAAGf,OAAO,CAAC,oBAAD,CAA9B;;AACA,IAAMgB,gBAAgB,GAAGhB,OAAO,CAAC,sBAAD,CAAhC;;AACA,IAAMiB,cAAc,GAAGjB,OAAO,CAAC,oBAAD,CAA9B;;AACA,IAAMkB,iBAAiB,GAAGlB,OAAO,CAAC,uBAAD,CAAjC;;AACA,IAAMmB,eAAe,GAAGnB,OAAO,CAAC,qBAAD,CAA/B;;AACA,IAAMoB,YAAY,GAAGpB,OAAO,CAAC,iBAAD,CAA5B;;AACA,IAAMqB,YAAY,GAAGrB,OAAO,CAAC,iBAAD,CAA5B;;AACA,IAAMsB,cAAc,GAAGtB,OAAO,CAAC,oBAAD,CAA9B;;AACA,IAAMuB,cAAc,GAAGvB,OAAO,CAAC,oBAAD,CAA9B;;AACA,IAAMwB,iBAAiB,GAAGxB,OAAO,CAAC,uBAAD,CAAjC;;IAEMyB,c;;;;;AACJ,0BAAYC,OAAZ,EAAqB;AAAA;;AAAA;;AACnB;;AADmB,eAGQA,OAAO,IAAI,EAHnB;AAAA,QAGZC,OAHY,QAGZA,OAHY;AAAA,QAGHC,OAHG,QAGHA,OAHG;;AAInB,UAAKC,GAAL,GAAW;AACTC,MAAAA,OAAO,EAAE,IAAIjB,oBAAJ,EADA;AAETkB,MAAAA,SAAS,EAAE,IAAItB,cAAJ,EAFF;AAGTuB,MAAAA,UAAU,EAAE,IAAI1B,SAAJ,CAAc;AAAC2B,QAAAA,GAAG,EAAE,YAAN;AAAoBC,QAAAA,KAAK,EAAE,KAA3B;AAAkCC,QAAAA,UAAU,EAAE,IAAIpB,cAAJ;AAA9C,OAAd,CAHH;AAITqB,MAAAA,aAAa,EAAE,IAAItB,0BAAJ,EAJN;AAKTuB,MAAAA,IAAI,EAAE,IAAI/B,SAAJ,CAAc;AAAC2B,QAAAA,GAAG,EAAE,MAAN;AAAcC,QAAAA,KAAK,EAAE,KAArB;AAA4BC,QAAAA,UAAU,EAAE,IAAI3B,QAAJ;AAAxC,OAAd,CALG;AAMT8B,MAAAA,SAAS,EAAE,IAAIhC,SAAJ,CAAc;AACvB2B,QAAAA,GAAG,EAAE,WADkB;AAEvBC,QAAAA,KAAK,EAAE,KAFgB;AAGvBK,QAAAA,KAAK,EAAE,IAHgB;AAIvBJ,QAAAA,UAAU,EAAE,IAAI5B,QAAJ,CAAa;AAACiC,UAAAA,QAAQ,EAAEZ;AAAX,SAAb,CAJW;AAKvBY,QAAAA,QAAQ,EAAEb;AALa,OAAd,CANF;AAaTc,MAAAA,UAAU,EAAE,IAAItB,eAAJ,EAbH;AAcTuB,MAAAA,UAAU,EAAE,IAAIpC,SAAJ,CAAc;AAAC2B,QAAAA,GAAG,EAAE,YAAN;AAAoBC,QAAAA,KAAK,EAAE,IAA3B;AAAiCC,QAAAA,UAAU,EAAE,IAAIxB,cAAJ;AAA7C,OAAd,CAdH;AAeTgC,MAAAA,SAAS,EAAE,IAAIpB,cAAJ,EAfF;AAgBTqB,MAAAA,UAAU,EAAE,IAAItC,SAAJ,CAAc;AAAC2B,QAAAA,GAAG,EAAE,YAAN;AAAoBC,QAAAA,KAAK,EAAE,KAA3B;AAAkCC,QAAAA,UAAU,EAAE,IAAIzB,cAAJ;AAA9C,OAAd,CAhBH;AAiBTmC,MAAAA,WAAW,EAAE,IAAI7B,gBAAJ,EAjBJ;AAkBT8B,MAAAA,eAAe,EAAE,IAAIlC,oBAAJ,EAlBR;AAmBTmC,MAAAA,SAAS,EAAE,IAAI9B,cAAJ,EAnBF;AAoBT+B,MAAAA,YAAY,EAAE,IAAIxB,iBAAJ,EApBL;AAqBTyB,MAAAA,YAAY,EAAE,IAAI/B,iBAAJ,EArBL;AAsBTgC,MAAAA,OAAO,EAAE,IAAI9B,YAAJ,EAtBA;AAuBT+B,MAAAA,OAAO,EAAE,IAAI9B,YAAJ,EAvBA;AAwBT+B,MAAAA,UAAU,EAAE,IAAI9C,SAAJ,CAAc;AAAC2B,QAAAA,GAAG,EAAE,YAAN;AAAoBC,QAAAA,KAAK,EAAE,IAA3B;AAAiCC,QAAAA,UAAU,EAAE,IAAIb,cAAJ;AAA7C,OAAd;AAxBH,KAAX;AAJmB;AA8BpB;;;;4BAEO+B,K,EAAO3B,O,EAAS;AACtBA,MAAAA,OAAO,CAAC4B,MAAR,GAAiB,IAAIlD,MAAJ,EAAjB;AACAiD,MAAAA,KAAK,CAACT,UAAN,GAAmBlB,OAAO,CAACkB,UAAR,GAAqB,EAAxC;AACAS,MAAAA,KAAK,CAACE,QAAN,GAAiB7B,OAAO,CAAC6B,QAAR,GAAmB,EAApC;AAEA7B,MAAAA,OAAO,CAAC8B,QAAR,GAAmB,EAAnB;AACA9B,MAAAA,OAAO,CAAC+B,UAAR,GAAqB,CAArB;AACA,WAAK5B,GAAL,CAASQ,IAAT,CAAcqB,OAAd,CAAsBL,KAAK,CAAChB,IAA5B,EAAkCX,OAAlC;AACA,WAAKG,GAAL,CAASS,SAAT,CAAmBoB,OAAnB,CAA2BL,KAAK,CAACM,IAAjC,EAAuCjC,OAAvC;AAEA2B,MAAAA,KAAK,CAACX,UAAN,GAAmBhB,OAAO,CAAC4B,MAAR,CAAeZ,UAAlC,CAVsB,CAYtB;;AACA,UAAMkB,IAAI,GAAIP,KAAK,CAACO,IAAN,GAAa,EAA3B;;AAEA,eAASC,OAAT,CAAiBC,CAAjB,EAAoB;AAClB,4BAAaA,CAAC,CAACC,MAAF,GAAW,CAAxB;AACD;;AAEDV,MAAAA,KAAK,CAACT,UAAN,CAAiBoB,OAAjB,CAAyB,UAAAC,SAAS,EAAI;AACpC,YAAMC,GAAG,GAAGL,OAAO,CAACD,IAAD,CAAnB;AACAK,QAAAA,SAAS,CAACC,GAAV,GAAgBA,GAAhB;AACAN,QAAAA,IAAI,CAACO,IAAL,CAAU;AACRC,UAAAA,EAAE,EAAEF,GADI;AAERG,UAAAA,IAAI,EAAElE,OAAO,CAACmE,SAFN;AAGRC,UAAAA,MAAM,EAAEN,SAAS,CAACO,MAHV;AAIRC,UAAAA,UAAU,EAAE;AAJJ,SAAV;AAMD,OATD,EAnBsB,CA8BtB;;AACA,UAAIpB,KAAK,CAACE,QAAN,CAAeQ,MAAf,GAAwB,CAA5B,EAA+B;AAC7B,YAAMW,OAAO,GAAG;AACdN,UAAAA,EAAE,EAAEP,OAAO,CAACD,IAAD,CADG;AAEdS,UAAAA,IAAI,EAAElE,OAAO,CAACwE,QAFA;AAGdJ,UAAAA,MAAM,uBAAgBlB,KAAK,CAACuB,EAAtB;AAHQ,SAAhB;AAKAhB,QAAAA,IAAI,CAACO,IAAL,CAAUO,OAAV;AACA,YAAMG,UAAU,GAAG;AACjBT,UAAAA,EAAE,EAAEP,OAAO,CAACD,IAAD,CADM;AAEjBS,UAAAA,IAAI,EAAElE,OAAO,CAAC2E,UAFG;AAGjBP,UAAAA,MAAM,kCAA2BlB,KAAK,CAACuB,EAAjC;AAHW,SAAnB;AAKAhB,QAAAA,IAAI,CAACO,IAAL,CAAUU,UAAV;AAEAxB,QAAAA,KAAK,CAACE,QAAN,CAAeS,OAAf,CAAuB,UAAAe,IAAI,EAAI;AAC7BA,UAAAA,IAAI,CAACC,UAAL,GAAkB/E,QAAQ,CAACgF,aAAT,CAAuBF,IAAI,CAACG,GAA5B,CAAlB;AACD,SAFD;AAIAxD,QAAAA,OAAO,CAACyD,WAAR,CAAoBhB,IAApB,CAAyB;AACvBiB,UAAAA,WAAW,oBAAa/B,KAAK,CAACuB,EAAnB,CADY;AAEvBC,UAAAA,UAAU,sBAAexB,KAAK,CAACuB,EAArB;AAFa,SAAzB;AAID;;AAED,UAAMS,eAAe,GAAG,EAAxB;AACA,UAAIC,SAAJ;AACAjC,MAAAA,KAAK,CAACkC,KAAN,CAAYvB,OAAZ,CAAoB,UAAAwB,MAAM,EAAI;AAC5B,YAAIA,MAAM,CAACC,IAAP,KAAgB,YAApB,EAAkC;AAChC,cAAMvB,GAAG,GAAGL,OAAO,CAACD,IAAD,CAAnB;AACA0B,UAAAA,SAAS,GAAG5D,OAAO,CAAC6D,KAAR,CAAcC,MAAM,CAACE,OAArB,CAAZ;AACA9B,UAAAA,IAAI,CAACO,IAAL,CAAU;AACRC,YAAAA,EAAE,EAAEF,GADI;AAERG,YAAAA,IAAI,EAAElE,OAAO,CAACwF,KAFN;AAGRpB,YAAAA,MAAM,qBAAce,SAAS,CAACM,IAAxB,cAAgCN,SAAS,CAACO,SAA1C;AAHE,WAAV;AAKAxC,UAAAA,KAAK,CAACyC,UAAN,GAAmB;AACjB5B,YAAAA,GAAG,EAAHA;AADiB,WAAnB;AAGAb,UAAAA,KAAK,CAAC0C,KAAN,GAAcrE,OAAO,CAAC6D,KAAR,CAAcC,MAAM,CAACE,OAArB,CAAd;AACD,SAZD,MAYO,IAAIF,MAAM,CAACC,IAAP,KAAgB,OAApB,EAA6B;AAAA,cAC7BtC,OAD6B,GAClBE,KADkB,CAC7BF,OAD6B;AAElCmC,UAAAA,SAAS,GAAG5D,OAAO,CAAC6D,KAAR,CAAcC,MAAM,CAACE,OAArB,CAAZ;;AACA,cAAI,CAACvC,OAAL,EAAc;AACZA,YAAAA,OAAO,GAAGE,KAAK,CAACF,OAAN,GAAgB;AACxBe,cAAAA,GAAG,EAAEL,OAAO,CAACD,IAAD,CADY;AAExBgC,cAAAA,IAAI,mBAAY,EAAElE,OAAO,CAACsE,aAAtB,CAFoB;AAGxBC,cAAAA,OAAO,EAAE,EAHe;AAIxBrC,cAAAA,IAAI,EAAE;AAJkB,aAA1B;AAMAlC,YAAAA,OAAO,CAACwE,QAAR,CAAiB/B,IAAjB,CAAsBhB,OAAtB;AACAS,YAAAA,IAAI,CAACO,IAAL,CAAU;AACRC,cAAAA,EAAE,EAAEjB,OAAO,CAACe,GADJ;AAERG,cAAAA,IAAI,EAAE,6EAFE;AAGRE,cAAAA,MAAM,wBAAiBpB,OAAO,CAACyC,IAAzB;AAHE,aAAV;AAKD;;AACD,cAAIO,QAAQ,GAAGd,eAAe,CAACG,MAAM,CAACE,OAAR,CAA9B;;AACA,cAAI,CAACS,QAAL,EAAe;AACbA,YAAAA,QAAQ,GAAGtC,OAAO,CAACV,OAAO,CAACS,IAAT,CAAlB;AACAyB,YAAAA,eAAe,CAACG,MAAM,CAACE,OAAR,CAAf,GAAkCS,QAAlC;AACAhD,YAAAA,OAAO,CAACS,IAAR,CAAaO,IAAb,CAAkB;AAChBC,cAAAA,EAAE,EAAE+B,QADY;AAEhB9B,cAAAA,IAAI,EAAE,2EAFU;AAGhBE,cAAAA,MAAM,qBAAce,SAAS,CAACM,IAAxB,cAAgCN,SAAS,CAACO,SAA1C;AAHU,aAAlB;AAKD;;AACD1C,UAAAA,OAAO,CAAC8C,OAAR,CAAgB9B,IAAhB,CAAqB;AACnBjB,YAAAA,OAAO,EAAE;AACPgB,cAAAA,GAAG,EAAEiC;AADE,aADU;AAInBC,YAAAA,KAAK,EAAEZ,MAAM,CAACY;AAJK,WAArB;AAMD;AACF,OA/CD,EAzDsB,CA0GtB;;AACA/C,MAAAA,KAAK,CAACgD,MAAN,CAAarC,OAAb,CAAqB,UAAAsC,KAAK,EAAI;AAC5B;AACA,YAAMpC,GAAG,GAAGL,OAAO,CAACD,IAAD,CAAnB;AACA0C,QAAAA,KAAK,CAACpC,GAAN,GAAYA,GAAZ;AACAN,QAAAA,IAAI,CAACO,IAAL,CAAU;AACRC,UAAAA,EAAE,EAAEF,GADI;AAERG,UAAAA,IAAI,EAAElE,OAAO,CAACoG,KAFN;AAGRhC,UAAAA,MAAM,sBAAe+B,KAAK,CAAC9B,MAArB;AAHE,SAAV,EAJ4B,CAU5B;;AACA8B,QAAAA,KAAK,CAACE,OAAN,CAAcxC,OAAd,CAAsB,UAAAyC,MAAM,EAAI;AAAA,cACvBC,KADuB,GACdD,MADc,CACvBC,KADuB;;AAE9B,cAAIA,KAAJ,EAAW;AACTD,YAAAA,MAAM,CAACE,KAAP,GAAejF,OAAO,CAACkF,MAAR,CAAeC,WAAf,CAA2BH,KAA3B,CAAf;AACD;AACF,SALD;AAMD,OAjBD;AAkBD;;;2BAEMI,S,EAAWzD,K,EAAO;AACvByD,MAAAA,SAAS,CAACC,OAAV,CAAkB7G,SAAS,CAAC8G,gBAA5B;AACAF,MAAAA,SAAS,CAACG,QAAV,CAAmB,WAAnB,EAAgCxF,cAAc,CAACyF,oBAA/C;AAEA,UAAMC,0BAA0B,GAAG9D,KAAK,CAAC+D,UAAN,GAC/B;AACAC,QAAAA,gBAAgB,EAAEhE,KAAK,CAAC+D,UAAN,CAAiBC,gBADnC;AAEAC,QAAAA,SAAS,EAAEjE,KAAK,CAAC+D,UAAN,CAAiBE,SAF5B;AAGAC,QAAAA,eAAe,EAAElE,KAAK,CAAC+D,UAAN,CAAiBG,eAHlC;AAIAC,QAAAA,eAAe,EAAEnE,KAAK,CAAC+D,UAAN,CAAiBI;AAJlC,OAD+B,GAO/BC,SAPJ;AAQA,UAAMC,oBAAoB,GAAG;AAC3BC,QAAAA,iBAAiB,EAAEtE,KAAK,CAAC+D,UAAN,IAAoB/D,KAAK,CAAC+D,UAAN,CAAiBO,iBAD7B;AAE3BC,QAAAA,QAAQ,EAAEvE,KAAK,CAAC+D,UAAN,IAAoB/D,KAAK,CAAC+D,UAAN,CAAiBQ,QAFpB;AAG3B7E,QAAAA,SAAS,EACPM,KAAK,CAACN,SAAN,IAAmBM,KAAK,CAACN,SAAN,CAAgB8E,SAAnC,GACI;AACAA,UAAAA,SAAS,EAAExE,KAAK,CAACN,SAAN,CAAgB8E;AAD3B,SADJ,GAIIJ;AARqB,OAA7B;AAUA,UAAMK,gBAAgB,GAAGzE,KAAK,CAACN,SAAN,IAAmBM,KAAK,CAACN,SAAN,CAAgBgF,OAA5D;AACA,UAAMC,iBAAiB,GAAG;AACxBC,QAAAA,iBAAiB,EAAE5E,KAAK,CAAC4E,iBADD;AAExBC,QAAAA,aAAa,EAAE7E,KAAK,CAAC6E,aAFG;AAGxBC,QAAAA,kBAAkB,EAAE9E,KAAK,CAAC8E,kBAHF;AAIxBC,QAAAA,gBAAgB,EAAE/E,KAAK,CAAC+E;AAJA,OAA1B;AAOA,WAAKvG,GAAL,CAASC,OAAT,CAAiBuG,MAAjB,CAAwBvB,SAAxB,EAAmCY,oBAAnC;AACA,WAAK7F,GAAL,CAASE,SAAT,CAAmBsG,MAAnB,CAA0BvB,SAA1B,EAAqCzD,KAAK,CAACiF,UAA3C;AACA,WAAKzG,GAAL,CAASG,UAAT,CAAoBqG,MAApB,CAA2BvB,SAA3B,EAAsCzD,KAAK,CAACkF,KAA5C;AACA,WAAK1G,GAAL,CAASO,aAAT,CAAuBiG,MAAvB,CAA8BvB,SAA9B,EAAyCK,0BAAzC;AACA,WAAKtF,GAAL,CAASQ,IAAT,CAAcgG,MAAd,CAAqBvB,SAArB,EAAgCzD,KAAK,CAAChB,IAAtC;AACA,WAAKR,GAAL,CAASS,SAAT,CAAmB+F,MAAnB,CAA0BvB,SAA1B,EAAqCzD,KAAK,CAACM,IAA3C;AACA,WAAK9B,GAAL,CAASY,UAAT,CAAoB4F,MAApB,CAA2BvB,SAA3B,EAAsCzD,KAAK,CAACZ,UAA5C;AACA,WAAKZ,GAAL,CAASa,UAAT,CAAoB2F,MAApB,CAA2BvB,SAA3B,EAAsCzD,KAAK,CAACX,UAA5C;AACA,WAAKb,GAAL,CAASiB,eAAT,CAAyBuF,MAAzB,CAAgCvB,SAAhC,EAA2CzD,KAAK,CAACP,eAAjD,EAtCuB,CAwCvB;;AACA,WAAKjB,GAAL,CAASe,UAAT,CAAoByF,MAApB,CAA2BvB,SAA3B,EAAsCzD,KAAK,CAACT,UAA5C;AAEA,WAAKf,GAAL,CAASgB,WAAT,CAAqBwF,MAArB,CAA4BvB,SAA5B,EAAuCgB,gBAAvC;AACA,WAAKjG,GAAL,CAASoB,YAAT,CAAsBoF,MAAtB,CAA6BvB,SAA7B,EAAwCkB,iBAAxC;AACA,WAAKnG,GAAL,CAASkB,SAAT,CAAmBsF,MAAnB,CAA0BvB,SAA1B,EAAqCzD,KAAK,CAACN,SAA3C;AACA,WAAKlB,GAAL,CAASmB,YAAT,CAAsBqF,MAAtB,CAA6BvB,SAA7B,EAAwCzD,KAAK,CAACL,YAA9C;AACA,WAAKnB,GAAL,CAASc,SAAT,CAAmB0F,MAAnB,CAA0BvB,SAA1B,EAAqCzD,KAAK,CAACV,SAA3C;AACA,WAAKd,GAAL,CAASsB,OAAT,CAAiBkF,MAAjB,CAAwBvB,SAAxB,EAAmCzD,KAAK,CAACF,OAAzC,EAhDuB,CAgD4B;;AACnD,WAAKtB,GAAL,CAASqB,OAAT,CAAiBmF,MAAjB,CAAwBvB,SAAxB,EAAmCzD,KAAK,CAACyC,UAAzC,EAjDuB,CAiD+B;;AACtD,WAAKjE,GAAL,CAASuB,UAAT,CAAoBiF,MAApB,CAA2BvB,SAA3B,EAAsCzD,KAAK,CAACgD,MAA5C;;AAEA,UAAIhD,KAAK,CAACO,IAAV,EAAgB;AACd;AACAP,QAAAA,KAAK,CAACO,IAAN,CAAWI,OAAX,CAAmB,UAAAwE,GAAG,EAAI;AACxB,cAAIA,GAAG,CAACnE,IAAJ,KAAalE,OAAO,CAAC2E,UAAzB,EAAqC;AACnCgC,YAAAA,SAAS,CAAC2B,QAAV,CAAmB,eAAnB,EAAoC;AAAC,sBAAQD,GAAG,CAACpE;AAAb,aAApC;AACD;AACF,SAJD;AAKD;;AAED0C,MAAAA,SAAS,CAAC4B,SAAV;AACD;;;8BAESC,I,EAAM;AACd,UAAI,KAAKC,MAAT,EAAiB;AACf,aAAKA,MAAL,CAAYC,SAAZ,CAAsBF,IAAtB;AACA,eAAO,IAAP;AACD;;AAED,UAAIA,IAAI,CAAC/C,IAAL,KAAc,WAAlB,EAA+B;AAC7B7F,QAAAA,CAAC,CAAC+I,IAAF,CAAO,KAAKjH,GAAZ,EAAiB,UAAAkH,KAAK,EAAI;AACxBA,UAAAA,KAAK,CAACC,KAAN;AACD,SAFD;;AAGA,eAAO,IAAP;AACD;;AAED,WAAKJ,MAAL,GAAc,KAAK/G,GAAL,CAAS8G,IAAI,CAAC/C,IAAd,CAAd;;AACA,UAAI,KAAKgD,MAAT,EAAiB;AACf,aAAKA,MAAL,CAAYC,SAAZ,CAAsBF,IAAtB;AACD;;AACD,aAAO,IAAP;AACD;;;8BAESM,I,EAAM;AACd,UAAI,KAAKL,MAAT,EAAiB;AACf,aAAKA,MAAL,CAAYM,SAAZ,CAAsBD,IAAtB;AACD;AACF;;;+BAEUrD,I,EAAM;AACf,UAAI,KAAKgD,MAAT,EAAiB;AACf,YAAI,CAAC,KAAKA,MAAL,CAAYO,UAAZ,CAAuBvD,IAAvB,CAAL,EAAmC;AACjC,eAAKgD,MAAL,GAAcnB,SAAd;AACD;;AACD,eAAO,IAAP;AACD;;AACD,cAAQ7B,IAAR;AACE,aAAK,WAAL;AAAkB;AAChB,gBAAMwB,UAAU,GAAG,KAAKvF,GAAL,CAASO,aAAT,CAAuBiB,KAA1C;;AACA,gBAAI,KAAKxB,GAAL,CAASC,OAAT,CAAiBuB,KAAjB,IAA0B,KAAKxB,GAAL,CAASC,OAAT,CAAiBuB,KAAjB,CAAuBuE,QAArD,EAA+D;AAC7DR,cAAAA,UAAU,CAACQ,QAAX,GAAsB,KAAK/F,GAAL,CAASC,OAAT,CAAiBuB,KAAjB,CAAuBuE,QAA7C;AACD;;AACD,gBAAI,KAAK/F,GAAL,CAASC,OAAT,CAAiBuB,KAAjB,IAA0B,KAAKxB,GAAL,CAASC,OAAT,CAAiBuB,KAAjB,CAAuBsE,iBAArD,EAAwE;AACtEP,cAAAA,UAAU,CAACO,iBAAX,GAA+B,KAAK9F,GAAL,CAASC,OAAT,CAAiBuB,KAAjB,CAAuB+F,kBAAtD;AACD;;AACD,gBAAMC,eAAe,GAAG;AACtBxB,cAAAA,SAAS,EAAG,KAAKhG,GAAL,CAASC,OAAT,CAAiBuB,KAAjB,IAA0B,KAAKxB,GAAL,CAASC,OAAT,CAAiBuB,KAAjB,CAAuBN,SAAjD,IAA8D,KAAKlB,GAAL,CAASC,OAAT,CAAiBuB,KAAjB,CAAuBN,SAAvB,CAAiC8E,SAAhG,IAA8G,KADnG;AAEtBE,cAAAA,OAAO,EAAE,KAAKlG,GAAL,CAASgB,WAAT,CAAqBQ;AAFR,aAAxB;AAIA,gBAAMN,SAAS,GAAGuG,MAAM,CAACC,MAAP,CAAcF,eAAd,EAA+B,KAAKxH,GAAL,CAASkB,SAAT,CAAmBM,KAAlD,EAAyD,KAAKxB,GAAL,CAASoB,YAAT,CAAsBI,KAA/E,CAAlB;AACA,iBAAKA,KAAL,GAAa;AACXiF,cAAAA,UAAU,EAAE,KAAKzG,GAAL,CAASE,SAAT,CAAmBsB,KADpB;AAEXhB,cAAAA,IAAI,EAAE,KAAKR,GAAL,CAASQ,IAAT,CAAcgB,KAFT;AAGXM,cAAAA,IAAI,EAAE,KAAK9B,GAAL,CAASS,SAAT,CAAmBe,KAHd;AAIXX,cAAAA,UAAU,EAAE,KAAKb,GAAL,CAASa,UAAT,CAAoBW,KAJrB;AAKXT,cAAAA,UAAU,EAAE,KAAKf,GAAL,CAASe,UAAT,CAAoBS,KALrB;AAMXP,cAAAA,eAAe,EAAE,KAAKjB,GAAL,CAASiB,eAAT,CAAyBO,KAN/B;AAOX+D,cAAAA,UAAU,EAAVA,UAPW;AAQXmB,cAAAA,KAAK,EAAE,KAAK1G,GAAL,CAASG,UAAT,CAAoBqB,KARhB;AASXN,cAAAA,SAAS,EAATA,SATW;AAUX+C,cAAAA,UAAU,EAAE,KAAKjE,GAAL,CAASqB,OAAT,CAAiBG,KAVlB;AAWXF,cAAAA,OAAO,EAAE,KAAKtB,GAAL,CAASsB,OAAT,CAAiBE,KAXf;AAYXgD,cAAAA,MAAM,EAAE,KAAKxE,GAAL,CAASuB,UAAT,CAAoBC;AAZjB,aAAb;;AAeA,gBAAI,KAAKxB,GAAL,CAASY,UAAT,CAAoBY,KAAxB,EAA+B;AAC7B,mBAAKA,KAAL,CAAWZ,UAAX,GAAwB,KAAKZ,GAAL,CAASY,UAAT,CAAoBY,KAA5C;AACD;;AACD,mBAAO,KAAP;AACD;;AAED;AACE;AACA,iBAAO,IAAP;AArCJ;AAuCD;;;8BAESA,K,EAAO3B,O,EAAS;AACxB;AACA;AACA,UAAMkC,IAAI,GAAG,CAACP,KAAK,CAACmG,aAAN,IAAuB,EAAxB,EAA4BC,MAA5B,CAAmC,UAACC,CAAD,EAAIlB,GAAJ,EAAY;AAC1DkB,QAAAA,CAAC,CAAClB,GAAG,CAACpE,EAAL,CAAD,GAAYoE,GAAZ;;AACA,YAAIA,GAAG,CAACnE,IAAJ,KAAalE,OAAO,CAACwE,QAAzB,EAAmC;AACjCtB,UAAAA,KAAK,CAACE,QAAN,GAAiB7B,OAAO,CAAC6B,QAAR,CAAiBiF,GAAG,CAACjE,MAArB,EAA6BhB,QAA9C;AACD;;AACD,eAAOmG,CAAP;AACD,OANY,EAMV,EANU,CAAb;AAOAhI,MAAAA,OAAO,CAACiI,WAAR,GAAsB,CAACtG,KAAK,CAACE,QAAN,IAAkB,EAAnB,EAAuBkG,MAAvB,CAA8B,UAACC,CAAD,EAAIhF,OAAJ,EAAgB;AAClE,YAAIA,OAAO,CAACQ,GAAZ,EAAiB;AACfwE,UAAAA,CAAC,CAAChF,OAAO,CAACQ,GAAT,CAAD,GAAiBR,OAAjB;AACD;;AACD,eAAOgF,CAAP;AACD,OALqB,EAKnB,EALmB,CAAtB;AAMAhI,MAAAA,OAAO,CAACkI,YAAR,GAAuB,CAACvG,KAAK,CAACT,UAAN,IAAoB,EAArB,EAAyB6G,MAAzB,CAAgC,UAACC,CAAD,EAAIzF,SAAJ,EAAkB;AACvE,YAAIA,SAAS,CAACC,GAAd,EAAmB;AACjBwF,UAAAA,CAAC,CAACzF,SAAS,CAAC4F,OAAX,CAAD,GAAuBjG,IAAI,CAACK,SAAS,CAACC,GAAX,CAAJ,CAAoBK,MAA3C;AACD;;AACD,eAAOmF,CAAP;AACD,OALsB,EAKpB,EALoB,CAAvB;AAMAhI,MAAAA,OAAO,CAAC8B,QAAR,GAAmB,EAAnB,CAtBwB,CAwBxB;;AACAH,MAAAA,KAAK,CAACM,IAAN,GAAcN,KAAK,CAACM,IAAN,IAAcN,KAAK,CAACM,IAAN,CAAWmG,MAAX,CAAkBC,OAAlB,CAAf,IAA8C,EAA3D;AACA1G,MAAAA,KAAK,CAACM,IAAN,CAAWK,OAAX,CAAmB,UAAAgG,GAAG,EAAI;AACxBA,QAAAA,GAAG,CAACC,KAAJ,GAAaD,GAAG,CAACC,KAAJ,IAAaD,GAAG,CAACC,KAAJ,CAAUH,MAAV,CAAiBC,OAAjB,CAAd,IAA4C,EAAxD;AACD,OAFD;AAIA,WAAKlI,GAAL,CAASQ,IAAT,CAAc6H,SAAd,CAAwB7G,KAAK,CAAChB,IAA9B,EAAoCX,OAApC;AACA,WAAKG,GAAL,CAASS,SAAT,CAAmB4H,SAAnB,CAA6B7G,KAAK,CAACM,IAAnC,EAAyCjC,OAAzC;AAEA2B,MAAAA,KAAK,CAACkC,KAAN,GAAc,EAAd;;AACA,UAAIlC,KAAK,CAACF,OAAV,EAAmB;AACjB,YAAMgH,UAAU,GAAGvG,IAAI,CAACP,KAAK,CAACF,OAAN,CAAce,GAAf,CAAvB;AACA,YAAMkG,KAAK,GAAGD,UAAU,CAAC5F,MAAX,CAAkB6F,KAAlB,CAAwB,6CAAxB,CAAd;;AACA,YAAIA,KAAJ,EAAW;AACT,cAAMC,WAAW,GAAGD,KAAK,CAAC,CAAD,CAAzB;AACA,cAAMjH,OAAO,GAAGzB,OAAO,CAACwE,QAAR,CAAiBmE,WAAjB,CAAhB;AACAlH,UAAAA,OAAO,CAAC8C,OAAR,CAAgBjC,OAAhB,CAAwB,UAAAsG,MAAM,EAAI;AAChC,gBAAIA,MAAM,CAAC9E,MAAX,EAAmB;AACjB,kBAAMO,KAAK,GAAG;AACZN,gBAAAA,IAAI,EAAE,OADM;AAEZC,gBAAAA,OAAO,EAAE4E,MAAM,CAAC9E,MAAP,CAAc+E,KAFX;AAGZnE,gBAAAA,KAAK,EAAEkE,MAAM,CAAClE;AAHF,eAAd;AAKA/C,cAAAA,KAAK,CAACkC,KAAN,CAAYpB,IAAZ,CAAiB4B,KAAjB;AACD;AACF,WATD;AAUD;AACF;;AAED,UAAMyE,aAAa,GAAGnH,KAAK,CAACyC,UAAN,IAAoBlC,IAAI,CAACP,KAAK,CAACyC,UAAN,CAAiB5B,GAAlB,CAA9C;;AACA,UAAIsG,aAAJ,EAAmB;AACjB,YAAMhG,MAAM,GAAGgG,aAAa,CAACjG,MAAd,CAAqBkG,KAArB,CAA2B,SAA3B,EAAsC,CAAtC,CAAf;AACA,YAAM/E,OAAO,GAAGhE,OAAO,CAACgJ,UAAR,IAAsBhJ,OAAO,CAACgJ,UAAR,CAAmBlG,MAAnB,CAAtC;;AACA,YAAIkB,OAAO,KAAK+B,SAAhB,EAA2B;AACzBpE,UAAAA,KAAK,CAACkC,KAAN,CAAYpB,IAAZ,CAAiB;AACfsB,YAAAA,IAAI,EAAE,YADS;AAEfC,YAAAA,OAAO,EAAPA;AAFe,WAAjB;AAID;AACF;;AAEDrC,MAAAA,KAAK,CAACgD,MAAN,GAAe,CAAChD,KAAK,CAACgD,MAAN,IAAgB,EAAjB,EAAqBxE,GAArB,CAAyB,UAAA8I,SAAS,EAAI;AACnD,YAAMnC,GAAG,GAAG5E,IAAI,CAAC+G,SAAS,CAACzG,GAAX,CAAhB;AACA,eAAOxC,OAAO,CAAC2E,MAAR,CAAemC,GAAG,CAACjE,MAAnB,CAAP;AACD,OAHc,CAAf;AAKA,aAAOlB,KAAK,CAACmG,aAAb;AACA,aAAOnG,KAAK,CAACT,UAAb;AACA,aAAOS,KAAK,CAACE,QAAb;AACD;;;;EAnX0BlD,S;;AAsX7BoB,cAAc,CAACyF,oBAAf,GAAsC;AACpC0D,EAAAA,KAAK,EAAE,2DAD6B;AAEpC,aAAW,qEAFyB;AAGpC,cAAY,6DAHwB;AAIpC,kBAAgB,OAJoB;AAKpC,iBAAe;AALqB,CAAtC;AAQAC,MAAM,CAACC,OAAP,GAAiBrJ,cAAjB","sourcesContent":["const _ = require('../../../utils/under-dash');\r\n\r\nconst colCache = require('../../../utils/col-cache');\r\nconst XmlStream = require('../../../utils/xml-stream');\r\n\r\nconst RelType = require('../../rel-type');\r\n\r\nconst Merges = require('./merges');\r\n\r\nconst BaseXform = require('../base-xform');\r\nconst ListXform = require('../list-xform');\r\nconst RowXform = require('./row-xform');\r\nconst ColXform = require('./col-xform');\r\nconst DimensionXform = require('./dimension-xform');\r\nconst HyperlinkXform = require('./hyperlink-xform');\r\nconst MergeCellXform = require('./merge-cell-xform');\r\nconst DataValidationsXform = require('./data-validations-xform');\r\nconst SheetPropertiesXform = require('./sheet-properties-xform');\r\nconst SheetFormatPropertiesXform = require('./sheet-format-properties-xform');\r\nconst SheetViewXform = require('./sheet-view-xform');\r\nconst PageMarginsXform = require('./page-margins-xform');\r\nconst PageSetupXform = require('./page-setup-xform');\r\nconst PrintOptionsXform = require('./print-options-xform');\r\nconst AutoFilterXform = require('./auto-filter-xform');\r\nconst PictureXform = require('./picture-xform');\r\nconst DrawingXform = require('./drawing-xform');\r\nconst TablePartXform = require('./table-part-xform');\r\nconst RowBreaksXform = require('./row-breaks-xform');\r\nconst HeaderFooterXform = require('./header-footer-xform');\r\n\r\nclass WorkSheetXform extends BaseXform {\r\n  constructor(options) {\r\n    super();\r\n\r\n    const {maxRows, maxCols} = options || {};\r\n    this.map = {\r\n      sheetPr: new SheetPropertiesXform(),\r\n      dimension: new DimensionXform(),\r\n      sheetViews: new ListXform({tag: 'sheetViews', count: false, childXform: new SheetViewXform()}),\r\n      sheetFormatPr: new SheetFormatPropertiesXform(),\r\n      cols: new ListXform({tag: 'cols', count: false, childXform: new ColXform()}),\r\n      sheetData: new ListXform({\r\n        tag: 'sheetData',\r\n        count: false,\r\n        empty: true,\r\n        childXform: new RowXform({maxItems: maxCols}),\r\n        maxItems: maxRows,\r\n      }),\r\n      autoFilter: new AutoFilterXform(),\r\n      mergeCells: new ListXform({tag: 'mergeCells', count: true, childXform: new MergeCellXform()}),\r\n      rowBreaks: new RowBreaksXform(),\r\n      hyperlinks: new ListXform({tag: 'hyperlinks', count: false, childXform: new HyperlinkXform()}),\r\n      pageMargins: new PageMarginsXform(),\r\n      dataValidations: new DataValidationsXform(),\r\n      pageSetup: new PageSetupXform(),\r\n      headerFooter: new HeaderFooterXform(),\r\n      printOptions: new PrintOptionsXform(),\r\n      picture: new PictureXform(),\r\n      drawing: new DrawingXform(),\r\n      tableParts: new ListXform({tag: 'tableParts', count: true, childXform: new TablePartXform()}),\r\n    };\r\n  }\r\n\r\n  prepare(model, options) {\r\n    options.merges = new Merges();\r\n    model.hyperlinks = options.hyperlinks = [];\r\n    model.comments = options.comments = [];\r\n\r\n    options.formulae = {};\r\n    options.siFormulae = 0;\r\n    this.map.cols.prepare(model.cols, options);\r\n    this.map.sheetData.prepare(model.rows, options);\r\n\r\n    model.mergeCells = options.merges.mergeCells;\r\n\r\n    // prepare relationships\r\n    const rels = (model.rels = []);\r\n\r\n    function nextRid(r) {\r\n      return `rId${r.length + 1}`;\r\n    }\r\n\r\n    model.hyperlinks.forEach(hyperlink => {\r\n      const rId = nextRid(rels);\r\n      hyperlink.rId = rId;\r\n      rels.push({\r\n        Id: rId,\r\n        Type: RelType.Hyperlink,\r\n        Target: hyperlink.target,\r\n        TargetMode: 'External',\r\n      });\r\n    });\r\n\r\n    // prepare comment relationships\r\n    if (model.comments.length > 0) {\r\n      const comment = {\r\n        Id: nextRid(rels),\r\n        Type: RelType.Comments,\r\n        Target: `../comments${model.id}.xml`,\r\n      };\r\n      rels.push(comment);\r\n      const vmlDrawing = {\r\n        Id: nextRid(rels),\r\n        Type: RelType.VmlDrawing,\r\n        Target: `../drawings/vmlDrawing${model.id}.vml`,\r\n      };\r\n      rels.push(vmlDrawing);\r\n\r\n      model.comments.forEach(item => {\r\n        item.refAddress = colCache.decodeAddress(item.ref);\r\n      });\r\n\r\n      options.commentRefs.push({\r\n        commentName: `comments${model.id}`,\r\n        vmlDrawing: `vmlDrawing${model.id}`,\r\n      });\r\n    }\r\n\r\n    const drawingRelsHash = [];\r\n    let bookImage;\r\n    model.media.forEach(medium => {\r\n      if (medium.type === 'background') {\r\n        const rId = nextRid(rels);\r\n        bookImage = options.media[medium.imageId];\r\n        rels.push({\r\n          Id: rId,\r\n          Type: RelType.Image,\r\n          Target: `../media/${bookImage.name}.${bookImage.extension}`,\r\n        });\r\n        model.background = {\r\n          rId,\r\n        };\r\n        model.image = options.media[medium.imageId];\r\n      } else if (medium.type === 'image') {\r\n        let {drawing} = model;\r\n        bookImage = options.media[medium.imageId];\r\n        if (!drawing) {\r\n          drawing = model.drawing = {\r\n            rId: nextRid(rels),\r\n            name: `drawing${++options.drawingsCount}`,\r\n            anchors: [],\r\n            rels: [],\r\n          };\r\n          options.drawings.push(drawing);\r\n          rels.push({\r\n            Id: drawing.rId,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/drawing',\r\n            Target: `../drawings/${drawing.name}.xml`,\r\n          });\r\n        }\r\n        let rIdImage = drawingRelsHash[medium.imageId];\r\n        if (!rIdImage) {\r\n          rIdImage = nextRid(drawing.rels);\r\n          drawingRelsHash[medium.imageId] = rIdImage;\r\n          drawing.rels.push({\r\n            Id: rIdImage,\r\n            Type: 'http://schemas.openxmlformats.org/officeDocument/2006/relationships/image',\r\n            Target: `../media/${bookImage.name}.${bookImage.extension}`,\r\n          });\r\n        }\r\n        drawing.anchors.push({\r\n          picture: {\r\n            rId: rIdImage,\r\n          },\r\n          range: medium.range,\r\n        });\r\n      }\r\n    });\r\n\r\n    // prepare tables\r\n    model.tables.forEach(table => {\r\n      // relationships\r\n      const rId = nextRid(rels);\r\n      table.rId = rId;\r\n      rels.push({\r\n        Id: rId,\r\n        Type: RelType.Table,\r\n        Target: `../tables/${table.target}`,\r\n      });\r\n\r\n      // dynamic styles\r\n      table.columns.forEach(column => {\r\n        const {style} = column;\r\n        if (style) {\r\n          column.dxfId = options.styles.addDxfStyle(style);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  render(xmlStream, model) {\r\n    xmlStream.openXml(XmlStream.StdDocAttributes);\r\n    xmlStream.openNode('worksheet', WorkSheetXform.WORKSHEET_ATTRIBUTES);\r\n\r\n    const sheetFormatPropertiesModel = model.properties\r\n      ? {\r\n        defaultRowHeight: model.properties.defaultRowHeight,\r\n        dyDescent: model.properties.dyDescent,\r\n        outlineLevelCol: model.properties.outlineLevelCol,\r\n        outlineLevelRow: model.properties.outlineLevelRow,\r\n      }\r\n      : undefined;\r\n    const sheetPropertiesModel = {\r\n      outlineProperties: model.properties && model.properties.outlineProperties,\r\n      tabColor: model.properties && model.properties.tabColor,\r\n      pageSetup:\r\n        model.pageSetup && model.pageSetup.fitToPage\r\n          ? {\r\n            fitToPage: model.pageSetup.fitToPage,\r\n          }\r\n          : undefined,\r\n    };\r\n    const pageMarginsModel = model.pageSetup && model.pageSetup.margins;\r\n    const printOptionsModel = {\r\n      showRowColHeaders: model.showRowColHeaders,\r\n      showGridLines: model.showGridLines,\r\n      horizontalCentered: model.horizontalCentered,\r\n      verticalCentered: model.verticalCentered,\r\n    };\r\n\r\n    this.map.sheetPr.render(xmlStream, sheetPropertiesModel);\r\n    this.map.dimension.render(xmlStream, model.dimensions);\r\n    this.map.sheetViews.render(xmlStream, model.views);\r\n    this.map.sheetFormatPr.render(xmlStream, sheetFormatPropertiesModel);\r\n    this.map.cols.render(xmlStream, model.cols);\r\n    this.map.sheetData.render(xmlStream, model.rows);\r\n    this.map.autoFilter.render(xmlStream, model.autoFilter);\r\n    this.map.mergeCells.render(xmlStream, model.mergeCells);\r\n    this.map.dataValidations.render(xmlStream, model.dataValidations);\r\n\r\n    // For some reason hyperlinks have to be after the data validations\r\n    this.map.hyperlinks.render(xmlStream, model.hyperlinks);\r\n\r\n    this.map.pageMargins.render(xmlStream, pageMarginsModel);\r\n    this.map.printOptions.render(xmlStream, printOptionsModel);\r\n    this.map.pageSetup.render(xmlStream, model.pageSetup);\r\n    this.map.headerFooter.render(xmlStream, model.headerFooter);\r\n    this.map.rowBreaks.render(xmlStream, model.rowBreaks);\r\n    this.map.drawing.render(xmlStream, model.drawing); // Note: must be after rowBreaks\r\n    this.map.picture.render(xmlStream, model.background); // Note: must be after drawing\r\n    this.map.tableParts.render(xmlStream, model.tables);\r\n\r\n    if (model.rels) {\r\n      // add a <legacyDrawing /> node for each comment\r\n      model.rels.forEach(rel => {\r\n        if (rel.Type === RelType.VmlDrawing) {\r\n          xmlStream.leafNode('legacyDrawing', {'r:id': rel.Id});\r\n        }\r\n      });\r\n    }\r\n\r\n    xmlStream.closeNode();\r\n  }\r\n\r\n  parseOpen(node) {\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n      return true;\r\n    }\r\n\r\n    if (node.name === 'worksheet') {\r\n      _.each(this.map, xform => {\r\n        xform.reset();\r\n      });\r\n      return true;\r\n    }\r\n\r\n    this.parser = this.map[node.name];\r\n    if (this.parser) {\r\n      this.parser.parseOpen(node);\r\n    }\r\n    return true;\r\n  }\r\n\r\n  parseText(text) {\r\n    if (this.parser) {\r\n      this.parser.parseText(text);\r\n    }\r\n  }\r\n\r\n  parseClose(name) {\r\n    if (this.parser) {\r\n      if (!this.parser.parseClose(name)) {\r\n        this.parser = undefined;\r\n      }\r\n      return true;\r\n    }\r\n    switch (name) {\r\n      case 'worksheet': {\r\n        const properties = this.map.sheetFormatPr.model;\r\n        if (this.map.sheetPr.model && this.map.sheetPr.model.tabColor) {\r\n          properties.tabColor = this.map.sheetPr.model.tabColor;\r\n        }\r\n        if (this.map.sheetPr.model && this.map.sheetPr.model.outlineProperties) {\r\n          properties.outlineProperties = this.map.sheetPr.model.outlinePropertiesx;\r\n        }\r\n        const sheetProperties = {\r\n          fitToPage: (this.map.sheetPr.model && this.map.sheetPr.model.pageSetup && this.map.sheetPr.model.pageSetup.fitToPage) || false,\r\n          margins: this.map.pageMargins.model,\r\n        };\r\n        const pageSetup = Object.assign(sheetProperties, this.map.pageSetup.model, this.map.printOptions.model);\r\n        this.model = {\r\n          dimensions: this.map.dimension.model,\r\n          cols: this.map.cols.model,\r\n          rows: this.map.sheetData.model,\r\n          mergeCells: this.map.mergeCells.model,\r\n          hyperlinks: this.map.hyperlinks.model,\r\n          dataValidations: this.map.dataValidations.model,\r\n          properties,\r\n          views: this.map.sheetViews.model,\r\n          pageSetup,\r\n          background: this.map.picture.model,\r\n          drawing: this.map.drawing.model,\r\n          tables: this.map.tableParts.model,\r\n        };\r\n\r\n        if (this.map.autoFilter.model) {\r\n          this.model.autoFilter = this.map.autoFilter.model;\r\n        }\r\n        return false;\r\n      }\r\n\r\n      default:\r\n        // not quite sure how we get here!\r\n        return true;\r\n    }\r\n  }\r\n\r\n  reconcile(model, options) {\r\n    // options.merges = new Merges();\r\n    // options.merges.reconcile(model.mergeCells, model.rows);\r\n    const rels = (model.relationships || []).reduce((h, rel) => {\r\n      h[rel.Id] = rel;\r\n      if (rel.Type === RelType.Comments) {\r\n        model.comments = options.comments[rel.Target].comments;\r\n      }\r\n      return h;\r\n    }, {});\r\n    options.commentsMap = (model.comments || []).reduce((h, comment) => {\r\n      if (comment.ref) {\r\n        h[comment.ref] = comment;\r\n      }\r\n      return h;\r\n    }, {});\r\n    options.hyperlinkMap = (model.hyperlinks || []).reduce((h, hyperlink) => {\r\n      if (hyperlink.rId) {\r\n        h[hyperlink.address] = rels[hyperlink.rId].Target;\r\n      }\r\n      return h;\r\n    }, {});\r\n    options.formulae = {};\r\n\r\n    // compact the rows and cells\r\n    model.rows = (model.rows && model.rows.filter(Boolean)) || [];\r\n    model.rows.forEach(row => {\r\n      row.cells = (row.cells && row.cells.filter(Boolean)) || [];\r\n    });\r\n\r\n    this.map.cols.reconcile(model.cols, options);\r\n    this.map.sheetData.reconcile(model.rows, options);\r\n\r\n    model.media = [];\r\n    if (model.drawing) {\r\n      const drawingRel = rels[model.drawing.rId];\r\n      const match = drawingRel.Target.match(/\\/drawings\\/([a-zA-Z0-9]+)[.][a-zA-Z]{3,4}$/);\r\n      if (match) {\r\n        const drawingName = match[1];\r\n        const drawing = options.drawings[drawingName];\r\n        drawing.anchors.forEach(anchor => {\r\n          if (anchor.medium) {\r\n            const image = {\r\n              type: 'image',\r\n              imageId: anchor.medium.index,\r\n              range: anchor.range,\r\n            };\r\n            model.media.push(image);\r\n          }\r\n        });\r\n      }\r\n    }\r\n\r\n    const backgroundRel = model.background && rels[model.background.rId];\r\n    if (backgroundRel) {\r\n      const target = backgroundRel.Target.split('/media/')[1];\r\n      const imageId = options.mediaIndex && options.mediaIndex[target];\r\n      if (imageId !== undefined) {\r\n        model.media.push({\r\n          type: 'background',\r\n          imageId,\r\n        });\r\n      }\r\n    }\r\n\r\n    model.tables = (model.tables || []).map(tablePart => {\r\n      const rel = rels[tablePart.rId];\r\n      return options.tables[rel.Target];\r\n    });\r\n\r\n    delete model.relationships;\r\n    delete model.hyperlinks;\r\n    delete model.comments;\r\n  }\r\n}\r\n\r\nWorkSheetXform.WORKSHEET_ATTRIBUTES = {\r\n  xmlns: 'http://schemas.openxmlformats.org/spreadsheetml/2006/main',\r\n  'xmlns:r': 'http://schemas.openxmlformats.org/officeDocument/2006/relationships',\r\n  'xmlns:mc': 'http://schemas.openxmlformats.org/markup-compatibility/2006',\r\n  'mc:Ignorable': 'x14ac',\r\n  'xmlns:x14ac': 'http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac',\r\n};\r\n\r\nmodule.exports = WorkSheetXform;\r\n"],"file":"worksheet-xform.js"}